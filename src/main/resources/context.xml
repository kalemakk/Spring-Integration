<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jms="http://www.springframework.org/schema/integration/jms"
       xmlns:integration="http://www.springframework.org/schema/integration"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/integration/jms
            https://www.springframework.org/schema/integration/jms/spring-integration-jms.xsd
        http://www.springframework.org/schema/integration
         http://www.springframework.org/schema/integration/spring-integration.xsd">


    <bean id="connectionFactory" class="org.springframework.jms.connection.CachingConnectionFactory">
        <property name="targetConnectionFactory">
            <bean class="org.apache.activemq.ActiveMQConnectionFactory">
                <property name="brokerURL" value="tcp://127.0.0.1:61616"/>
            </bean>
        </property>
    </bean>

    <integration:channel id="inputChannel"/>
    <integration:channel id="outChannel"/>
    <integration:channel id="jmsChannel"/>


    <integration:gateway
            default-request-channel="inputChannel"
            service-interface="com.example.springintegration.CarGateWay"
    />


    <bean class="org.apache.activemq.command.ActiveMQQueue" id="activeMQQueue">
        <constructor-arg value="sample.queue"/>
    </bean>

    <bean class="org.apache.activemq.command.ActiveMQQueue" id="replyMQQueue">
        <constructor-arg value="reply.queue"/>
    </bean>

    <jms:outbound-channel-adapter
            channel="outChannel"
            connection-factory="connectionFactory"
            destination="activeMQQueue"
    >
    </jms:outbound-channel-adapter>


    <jms:inbound-gateway
    connection-factory="connectionFactory"
    request-channel="jmsChannel"
    request-destination="activeMQQueue"
    default-reply-destination="replyMQQueue"
    />

    <integration:object-to-string-transformer
    input-channel="inputChannel"
    output-channel="outChannel"
    />

    <integration:service-activator input-channel="jmsChannel" ref="messagePrinter" method="print"/>

    <bean class="com.example.springintegration.MessagePrinter" id="messagePrinter"/>
</beans>